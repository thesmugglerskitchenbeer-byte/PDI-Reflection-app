<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PDI Lesson Reflection – Part 3 Competencies</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.4;
    }

    body {
      margin: 0;
      padding: 1.5rem;
      background: #f5f5f5;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #ffffff;
      padding: 1.5rem 1.75rem 2rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
    }

    h1 {
      margin-top: 0;
      font-size: 1.6rem;
    }

    h2 {
      font-size: 1.2rem;
      margin-top: 1.4rem;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .field {
      flex: 1 1 180px;
      min-width: 0;
      display: flex;
      flex-direction: column;
      margin-bottom: 0.75rem;
    }

    label {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      border-radius: 6px;
      border: 1px solid #d0d0d0;
      padding: 0.4rem 0.5rem;
      font-size: 0.9rem;
      box-sizing: border-box;
      width: 100%;
      background: #fafafa;
    }

    textarea {
      resize: vertical;
      min-height: 48px;
    }

    .lesson-type {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.9rem;
    }

    .lesson-type label {
      font-weight: 500;
    }

    details.accordion {
      margin-top: 1rem;
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      background: #fafafa;
      overflow: hidden;
    }

    details.accordion > summary {
      cursor: pointer;
      padding: 0.65rem 0.8rem;
      list-style: none;
      font-weight: 600;
    }

    details.accordion[open] > summary {
      border-bottom: 1px solid #e0e0e0;
    }

    details.accordion > summary::-webkit-details-marker {
      display: none;
    }

    details.accordion > summary::after {
      content: "▸";
      float: right;
      transition: transform 0.15s ease;
    }

    details.accordion[open] > summary::after {
      transform: rotate(90deg);
    }

    .accordion-body {
      padding: 0.75rem 0.8rem 0.9rem;
      background: #ffffff;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.85rem;
    }

    th, td {
      border-bottom: 1px solid #f0f0f0;
      padding: 0.4rem;
      vertical-align: top;
    }

    th {
      text-align: left;
      font-weight: 600;
      background: #fafafa;
    }

    .score-select {
      width: 60px;
    }

    .score-col {
      text-align: center;
    }

    .notes-input {
      width: 100%;
    }

    .results-card {
      margin-top: 1.5rem;
      border-radius: 10px;
      padding: 1rem;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
      align-items: center;
    }

    .results-item-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #666;
    }

    .results-item-value {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .grade-pill {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.7rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .grade-unsuccessful {
      background: #ffe5e5;
      border: 1px solid #ffb3b3;
    }

    .grade-b {
      background: #fff5d6;
      border: 1px solid #ffd880;
    }

    .grade-a {
      background: #dcfadb;
      border: 1px solid #9be297;
    }

    .muted {
      font-size: 0.8rem;
      color: #777;
    }

    .reflection-box {
      width: 100%;
      margin-bottom: 0.75rem;
    }

    .btn-row {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
      cursor: pointer;
      background: #1f7aec;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    button.secondary {
      background: #ffffff;
      color: #333;
      border: 1px solid #d0d0d0;
      box-shadow: none;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .history-table th,
    .history-table td {
      border-bottom: 1px solid #f0f0f0;
      padding: 0.35rem;
    }

    .badge {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }

    @media (max-width: 600px) {
      body {
        padding: 0.75rem;
      }
      .container {
        padding: 1rem 1.1rem 1.4rem;
      }
      th:nth-child(1),
      td:nth-child(1) {
        width: 2rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>PDI Lesson Reflection (Part 3 – 17 Competencies)</h1>
  <p class="muted">
    Score each competency from 0–3. The calculator will work out your total, percentage, and grade.
  </p>

  <!-- Lesson details -->
  <section>
    <h2>Lesson details</h2>
    <div class="flex-row">
      <div class="field">
        <label for="date">Date</label>
        <input type="date" id="date" />
      </div>
      <div class="field">
        <label for="instructor">Instructor name</label>
        <input type="text" id="instructor" placeholder="Your name (optional)" />
      </div>
      <div class="field">
        <label for="pupil">Pupil initials</label>
        <input type="text" id="pupil" placeholder="e.g. AB" />
      </div>
      <div class="field">
        <label for="lessonNumber">Lesson number / stage</label>
        <input type="text" id="lessonNumber" placeholder="e.g. L8 – mid-stage" />
      </div>
    </div>
    <div class="flex-row">
      <div class="field">
        <label for="topic">Topic</label>
        <input type="text" id="topic" placeholder="e.g. Roundabouts, junctions, parking" />
      </div>
      <div class="field">
        <label>Lesson type</label>
        <div class="lesson-type">
          <label><input type="radio" name="lessonType" value="Planned" /> Planned</label>
          <label><input type="radio" name="lessonType" value="Co-created" /> Co-created</label>
          <label><input type="radio" name="lessonType" value="Reactive" /> Reactive/remedial</label>
        </div>
      </div>
    </div>
  </section>

  <!-- Competencies: Lesson planning -->
  <details class="accordion" open>
    <summary>1. Lesson planning (5 competencies)</summary>
    <div class="accordion-body">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Competency</th>
            <th class="score-col">Score (0–3)</th>
            <th>Notes (examples from lesson)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Agreed lesson structure / goals with pupil</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="1">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="How were goals agreed?"></textarea></td>
          </tr>
          <tr>
            <td>2</td>
            <td>Lesson matched learner’s needs, ability, and experience</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="2">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Evidence you pitched it right."></textarea></td>
          </tr>
          <tr>
            <td>3</td>
            <td>Lesson route appropriate for goals and pupil level</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="3">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Route choice & any changes."></textarea></td>
          </tr>
          <tr>
            <td>4</td>
            <td>Adapted plan appropriately when needed</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="4">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="What changed? How did you adapt?"></textarea></td>
          </tr>
          <tr>
            <td>5</td>
            <td>Balance of practice vs instruction / explanation</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="5">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Did pupil get enough wheel-time?"></textarea></td>
          </tr>
        </tbody>
      </table>
    </div>
  </details>

  <!-- Competencies: Risk management -->
  <details class="accordion">
    <summary>2. Risk management (5 competencies)</summary>
    <div class="accordion-body">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Competency</th>
            <th class="score-col">Score (0–3)</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>6</td>
            <td>Roles & responsibilities for safety made clear</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="6">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="How did you clarify who does what?"></textarea></td>
          </tr>
          <tr>
            <td>7</td>
            <td>Identified risks and hazards in good time</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="7">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Examples of early / late hazard spotting."></textarea></td>
          </tr>
          <tr>
            <td>8</td>
            <td>Managed risk actively (prompts, guidance, interventions)</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="8">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="How did you support risk?"></textarea></td>
          </tr>
          <tr>
            <td>9</td>
            <td>Kept the car and others safe at all times</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="9">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Any safety-critical issues? How handled?"></textarea></td>
          </tr>
          <tr>
            <td>10</td>
            <td>Used faults / risks as learning opportunities</td>
            <td class="score-col">
              <select class="score-select score-input" data-id="10">
                <option value="">–</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </td>
            <td><textarea class="notes-input" placeholder="Debrief style: calm, constructive?"></textarea></td>
          </tr>
        </tbody>
      </table>
    </div>
  </details>

  <!-- Competencies: Teaching & learning strategies -->
  <details class="accordion">
    <summary>3. Teaching & learning strategies (7 competencies)</summary>
    <div class="accordion-body">
      <table>
        <thead>
        <tr>
          <th>#</th>
          <th>Competency</th>
          <th class="score-col">Score (0–3)</th>
          <th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>11</td>
          <td>Teaching style matched pupil’s stage & needs</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="11">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="Level of instruction vs coaching."></textarea></td>
        </tr>
        <tr>
          <td>12</td>
          <td>Questioning used effectively (open, probing, checking)</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="12">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="Examples of questions used."></textarea></td>
        </tr>
        <tr>
          <td>13</td>
          <td>Feedback clear, timely, and balanced</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="13">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="What feedback did you give?"></textarea></td>
        </tr>
        <tr>
          <td>14</td>
          <td>Encouraged pupil reflection and self-evaluation</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="14">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="How did you get them thinking?"></textarea></td>
        </tr>
        <tr>
          <td>15</td>
          <td>Communication: clear, calm, and easy to follow</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="15">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="Any points where you confused them?"></textarea></td>
        </tr>
        <tr>
          <td>16</td>
          <td>Maintained pupil engagement and avoided overload</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="16">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="Energy, focus, breaks, pacing."></textarea></td>
        </tr>
        <tr>
          <td>17</td>
          <td>End-of-lesson summary & next steps agreed</td>
          <td class="score-col">
            <select class="score-select score-input" data-id="17">
              <option value="">–</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
            </select>
          </td>
          <td><textarea class="notes-input" placeholder="What did you agree for next time?"></textarea></td>
        </tr>
        </tbody>
      </table>
    </div>
  </details>

  <!-- Reflection text -->
  <section>
    <h2>Instructor reflection</h2>
    <div class="field reflection-box">
      <label for="whatWentWell">What went well in this lesson?</label>
      <textarea id="whatWentWell" placeholder="Key strengths in your instruction."></textarea>
    </div>
    <div class="field reflection-box">
      <label for="whatToImprove">What would you change or improve next time?</label>
      <textarea id="whatToImprove" placeholder="Specific ideas to adjust on your next lesson."></textarea>
    </div>
    <div class="field reflection-box">
      <label for="nextAction">One specific action for my next lesson:</label>
      <textarea id="nextAction" placeholder="e.g. 'Use more open questions before giving answers.'"></textarea>
    </div>
  </section>

  <!-- Results / calculator -->
  <section>
    <h2>Score & grade (auto-calculated)</h2>
    <div class="results-card">
      <div>
        <div class="results-item-label">Total score</div>
        <div class="results-item-value">
          <span id="totalScore">0</span> / 51
        </div>
      </div>
      <div>
        <div class="results-item-label">Percentage</div>
        <div class="results-item-value">
          <span id="percentage">0.0</span>%
        </div>
      </div>
      <div>
        <div class="results-item-label">Grade</div>
        <div class="results-item-value">
          <span id="gradePill" class="grade-pill grade-unsuccessful">Unsuccessful</span>
        </div>
      </div>
      <div>
        <div class="results-item-label">Based on boundaries</div>
        <div class="muted">
          0–30 = Unsuccessful<br />
          31–40 = B grade<br />
          41–51 = A grade
        </div>
      </div>
    </div>

    <div class="btn-row">
      <button id="saveBtn">Save this reflection to history</button>
      <button id="clearBtn" class="secondary" type="button">Clear scores</button>
      <span class="muted">History is stored only in this browser/device.</span>
    </div>
  </section>

  <!-- History -->
  <details class="accordion" style="margin-top:1.5rem;">
    <summary>Reflection history (local)</summary>
    <div class="accordion-body">
      <p class="muted">
        Each time you click “Save this reflection to history”, a summary is stored here (in your browser only).
      </p>
      <table class="history-table" id="historyTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Pupil</th>
            <th>Topic</th>
            <th>Total / 51</th>
            <th>%</th>
            <th>Grade</th>
          </tr>
        </thead>
        <tbody id="historyBody">
          <!-- Filled by JavaScript -->
        </tbody>
      </table>
    </div>
  </details>
</div>

<script>
  (function () {
    const MAX_SCORE = 51;
    const scoreInputs = Array.from(document.querySelectorAll(".score-input"));
    const totalScoreEl = document.getElementById("totalScore");
    const percentageEl = document.getElementById("percentage");
    const gradePill = document.getElementById("gradePill");
    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");
    const historyBody = document.getElementById("historyBody");
    const STORAGE_KEY = "pdiLessonReflections";

    function calculateScores() {
      let total = 0;

      scoreInputs.forEach((select) => {
        const val = select.value;
        if (val !== "") {
          const num = parseInt(val, 10);
          if (!isNaN(num)) {
            total += num;
          }
        }
      });

      const percentage = (total / MAX_SCORE) * 100;

      totalScoreEl.textContent = total.toString();
      percentageEl.textContent = percentage.toFixed(1);

      updateGrade(total);
    }

    function updateGrade(total) {
      let grade = "Unsuccessful";
      let className = "grade-unsuccessful";

      if (total >= 41) {
        grade = "A grade";
        className = "grade-a";
      } else if (total >= 31) {
        grade = "B grade";
        className = "grade-b";
      }

      gradePill.textContent = grade;
      gradePill.className = "grade-pill " + className;
    }

    function getRadioValue(name) {
      const checked = document.querySelector('input[name="' + name + '"]:checked');
      return checked ? checked.value : "";
    }

    function saveReflection() {
      const dateVal = document.getElementById("date").value || "";
      const pupilVal = document.getElementById("pupil").value || "";
      const topicVal = document.getElementById("topic").value || "";
      const totalVal = parseInt(totalScoreEl.textContent, 10) || 0;
      const percentageVal = parseFloat(percentageEl.textContent) || 0;
      const gradeVal = gradePill.textContent.trim();
      const lessonType = getRadioValue("lessonType");

      const record = {
        date: dateVal,
        pupil: pupilVal,
        topic: topicVal,
        total: totalVal,
        percentage: percentageVal,
        grade: gradeVal,
        lessonType: lessonType,
        createdAt: new Date().toISOString()
      };

      const existing = loadHistory();
      existing.push(record);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));
      renderHistory(existing);
    }

    function loadHistory() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.error("Error parsing history from storage", e);
        return [];
      }
    }

    function renderHistory(records) {
      historyBody.innerHTML = "";
      if (!records.length) {
        const row = document.createElement("tr");
        const cell = document.createElement("td");
        cell.colSpan = 6;
        cell.className = "muted";
        cell.textContent = "No reflections saved yet.";
        row.appendChild(cell);
        historyBody.appendChild(row);
        return;
      }

      // Sort from newest to oldest by createdAt
      records.sort((a, b) => (b.createdAt || "").localeCompare(a.createdAt || ""));

      records.forEach((rec) => {
        const tr = document.createElement("tr");

        const dateCell = document.createElement("td");
        dateCell.textContent = rec.date || "-";

        const pupilCell = document.createElement("td");
        pupilCell.textContent = rec.pupil || "-";

        const topicCell = document.createElement("td");
        topicCell.textContent = rec.topic || "-";

        const totalCell = document.createElement("td");
        totalCell.textContent = rec.total + " / 51";

        const pctCell = document.createElement("td");
        pctCell.textContent = rec.percentage.toFixed(1) + "%";

        const gradeCell = document.createElement("td");
        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = rec.grade;
        gradeCell.appendChild(badge);

        tr.appendChild(dateCell);
        tr.appendChild(pupilCell);
        tr.appendChild(topicCell);
        tr.appendChild(totalCell);
        tr.appendChild(pctCell);
        tr.appendChild(gradeCell);

        historyBody.appendChild(tr);
      });
    }

    function clearScores() {
      scoreInputs.forEach((select) => {
        select.value = "";
      });
      calculateScores();
    }

    // Attach listeners
    scoreInputs.forEach((select) => {
      select.addEventListener("change", calculateScores);
    });

    saveBtn.addEventListener("click", function (e) {
      e.preventDefault();
      saveReflection();
    });

    clearBtn.addEventListener("click", function (e) {
      e.preventDefault();
      clearScores();
    });

    // Initial load
    calculateScores();
    renderHistory(loadHistory());
  })();
</script>
</body>
</html>
